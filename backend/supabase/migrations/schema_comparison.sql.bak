-- Schema Comparison Analysis

-- OLD: routine_completions (simple)
CREATE TABLE routine_completions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT NOT NULL DEFAULT 'default-user',
  date DATE NOT NULL,
  completed BOOLEAN DEFAULT false,
  steps_completed INTEGER DEFAULT 0,
  steps_skipped INTEGER DEFAULT 0,
  total_time_mins INTEGER,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, date)
);

-- NEW: morning_routine_logs (comprehensive)
CREATE TABLE morning_routine_logs (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id TEXT NOT NULL,
    date DATE NOT NULL,
    wake_time TIMESTAMP WITH TIME ZONE,
    sleep_score INTEGER,
    sleep_duration INTEGER,
    sleep_efficiency DECIMAL(5,2),
    deep_sleep_duration INTEGER,
    rem_sleep_duration INTEGER,
    routine_started_at TIMESTAMP WITH TIME ZONE,
    routine_completed_at TIMESTAMP WITH TIME ZONE,
    status TEXT CHECK (status IN ('pending', 'in_progress', 'completed', 'skipped')) DEFAULT 'pending',
    
    -- Individual step completion times
    wake_grounding_completed_at TIMESTAMP WITH TIME ZONE,
    reset_space_completed_at TIMESTAMP WITH TIME ZONE,
    identity_direction_completed_at TIMESTAMP WITH TIME ZONE,
    workout_completed_at TIMESTAMP WITH TIME ZONE,
    cool_down_completed_at TIMESTAMP WITH TIME ZONE,
    recenter_completed_at TIMESTAMP WITH TIME ZONE,
    
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    UNIQUE(user_id, date)
);

-- OLD: screentime_logs (per-app tracking)
CREATE TABLE screentime_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT NOT NULL DEFAULT 'default-user',
  date DATE NOT NULL,
  app_name TEXT NOT NULL,
  duration_mins INTEGER NOT NULL,
  is_distraction_app BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- NEW: screen_time_summaries (daily summaries + goals)
CREATE TABLE screen_time_summaries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    date DATE NOT NULL,
    total_screen_time INTEGER NOT NULL, -- in minutes
    focus_score INTEGER NOT NULL CHECK (focus_score >= 0 AND focus_score <= 100),
    app_usage JSONB NOT NULL DEFAULT '{}',
    distraction_patterns JSONB NOT NULL DEFAULT '{}',
    break_reminders INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, date)
);
